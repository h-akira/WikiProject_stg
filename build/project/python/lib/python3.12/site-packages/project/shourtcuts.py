from had.shourtcuts import reverse
# from had.shourtcuts import error_render

def reverse_for_slug(app_name, username, slug):
  # app_nameはwiki:detail等
  if "/" not in slug:
    return reverse(app_name+"1", username=username, slug1=slug)
  slug_list = slug.split("/")
  if slug_list[0] == "":
    raise Exception("slug is empty")
  if slug_list[-1] == "":
    slug_list.pop()
  length = len(slug_list)
  kwargs = {"username": username}
  for i, s in enumerate(slug_list):
    kwargs["slug"+str(i+1)] = s
  return reverse(app_name+str(length), **kwargs)

def redirect_for_slug(app_name, username, slug, set_cookie=None, **kwargs):
  if set_cookie:
    return {
      "statusCode": 302,
      "headers": {
        "Location": reverse_for_slug(app_name, username, slug),
        # "Set-Cookie": set_cookie
      },
      "multiValueHeaders": {
        "Set-Cookie": set_cookie
      }
    }
  else:
    return {
      "statusCode": 302,
      "headers": {
        "Location": reverse_for_slug(app_name, username, slug)
      }
    }
