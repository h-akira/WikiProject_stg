from had.shourtcuts import render, redirect, error_render, RenderSettings
from project import settings
# from project.shourtcuts import redirect_for_slug, reverse_for_slug
# import random
# try:
#   import boto3
#   from botocore.exceptions import ClientError
#   from boto3.dynamodb.conditions import Key, Attr
# except ModuleNotFoundError:
#   pass
# import traceback
import base64
import os
import io
import cgi


def get(request, username, name):
  return error_render(request, error_message = f"{username}, {name}")

def post(request, username):
  import boto3
  s3 = boto3.client('s3')
  is_base64_encoded = request.event["isBase64Encoded"]
  # 画像データをデコード
  # if is_base64_encoded:
  #   # image_data = base64.b64decode(request.body)
  #   image_data = base64.b64decode(request.event["body"])
  # else:
  #   image_data = request.event["body"]
  image_data = base64.b64decode(request.event["body"])
  # image_data = request.event["body"]
  # ファイル名の取得（例: クエリパラメータやヘッダーから取得）
  file_name = "test.png"
  # S3バケットにアップロード
  bucket_name = settings.AWS["S3"]["bucket"]
  s3.put_object(
    Bucket=bucket_name, 
    Key=os.path.join("had/test", file_name), 
    Body=image_data, 
    ContentType='image/png'
  )
  return error_render(request, error_message = f"{username}\n, {request.body.keys()},\n{request.body.values()}")

